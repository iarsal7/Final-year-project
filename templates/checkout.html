{% extends 'test.html' %}

{% block content %}
<div class="py-5 text-center">
        <img class="d-block mx-auto mb-4" src="https://getbootstrap.com/assets/brand/bootstrap-solid.svg" alt="" width="72" height="72">
        <h2>Checkout form</h2>
      </div>
      <div class="container">
<div class="row">
        <div class="col-md-4 order-md-2 mb-4">
          <h4 class="d-flex justify-content-between align-items-center mb-3">
            <span class="" style="color:#0e8ce4; font-weight: 500;">Shipping and Billing</span>
            {% comment %} <span class="badge badge-secondary badge-pill">3</span> {% endcomment %}
          </h4>
          <ul class="list-group mb-3">
            <li class="list-group-item d-flex justify-content-between lh-condensed">
              <div>
                <h6 class="my-0" id="model-name">{{request.user.first_name}} {{request.user.last_name}}</h6>
                <small class="text" id="model-address">{{user.address}}</small>
              </div>
              <button class="btn btn-link" type="submit" data-toggle="modal" data-target="#addressModal"><i class="fas fa-edit"></i></button>
            </li>
            <li class="list-group-item d-flex justify-content-between lh-condensed">
              <div>
                <h6 class="my-0" id="model-phone">{{user.phone}}</h6>
                <small class="text-muted"></small>
              </div>
            </li>
            <li class="list-group-item d-flex justify-content-between lh-condensed">
              <div>
                <h6 class="my-0" id="model-email">{{user.email}}</h6>
              </div>
            </li>
            
            <li class="list-group-item d-flex justify-content-between bg-light">
              <div class="" style="color:#0e8ce4">
                <h6 class="my-0 ">Order Summary</h6>
                {% comment %} <small>EXAMPLECODE</small> {% endcomment %}
              </div>
              {% comment %} <span class="text-success text-dark">Rs {{total}}</span> {% endcomment %}
            </li>

            
            <li class="list-group-item d-flex justify-content-between">
              <span>Subtotal</span>
              <strong>Rs {{total}}</strong>
            </li>
            <li class="list-group-item d-flex justify-content-between">
              <span>Shipping Fee</span>
              <strong>Rs {{shipping}}</strong>
            </li>

            
            <li class="list-group-item d-flex justify-content-between">
              <span>Total</span>
              <strong>Rs {{Gtotal}}</strong>
            </li>
          </ul>

            <form method="post" id="placeOrder">{% csrf_token %}
            <div class="input-group-btn">
            <button class="btn-round btn-info ml-auto button cart_button_checkout mt-4 " style="background:#0e8ce4 ; width: 100%;" type="submit">Place Order</button>
            </div>
            </form>
        </div>

            
<div class="col-md-8 order-md-1">
          
   {% if cart %}
        <div class="">

							<table id="cartTable" class="table table-bordered  table-striped">
         						 <tr class="table" style="color:#0e8ce4 ;text-align:center">
         						 <th scope="col" class=" cart_item_text" style="font-weight: 500;">Image</th>
         						   <th scope="col" class=" cart_item_text" style="font-weight: 500;">Name</th>
         						   <th scope="col" class=" cart_item_text" style="font-weight: 500;">Quantity</th>
         						   <th scope="col" class=" cart_item_text"style="font-weight: 500;">Product Price</th>
         						   <th scope="col" class=" cart_item_text" style="font-weight: 500;">Total</th>
         						   
         						 </tr>

         						 {% for obj in cart.all %}
         						 <tr id="cart-{{obj.products.id}}"  >
         						     <td><a href=""><img src="{{obj.products.image.url}}" heght="100" width="100"></a></td>
         						     <td class="cartName cartData cart_item_text" name="name"> {{obj.products.title}}</td>
         						     <td style="text-align:center" class="cartQuantity cartData cart_item_text" name="address">{{obj.quantity}}</td>
									  <td style="text-align:center" class="cartPrice cartData cart_item_text" id="price" name="age">Rs {{obj.products.price|floatformat:"0" }}</td>
         						     <td class="cartTotal cartData cart_item_text " name="total">{{obj.total|floatformat:"0" }}</td>
         						 </tr>
         						 {% endfor %}
        					</table>

						</div>

        {% else %}
            <h1></h1>
          {% endif %}
    </div> 

</div> 
      

</div>
{% endblock content %}

{% block javascript %}
<script>
$("form#placeOrder").submit(function(event) {
  
    event.preventDefault();
    
        $.ajax({
            url: '{% url 'ajaxOrder' %}',
            data: {
            
            },
            dataType: 'json',

            success: function (data) {
              if (data.status=='ok') {
                

                window.location.href='checkout/success'

              }

              else{
     
                   }  

              }
            
             
        });
   
});


</script>
{% endblock javascript %}

